<div class='row' id='ingredients'>
	<div class='col-md-3 visible-md visible-lg' id='ingredient-list'>
		<ul>
		<% Ingredient.all.each do |i| %>
			<li class='list-ingredient' data-id='<%= i.id %>'>
				<%= i.name %>
			</li>
		<% end %>
		</ul>
	</div>
	
	<div class='col-md-9 col-sm-12' id='ingredients-search-container'>
		<div class='row'>
			<div class='col-md-offset-3 col-md-6 col-sm-8 col-sm-offset-2' id='logo-container'>
				<div id='logo'>
					<%= image_tag "ingredient_logo.png", id: 'logo-img' %>
				</div>
			</div>
			
			<div class='col-md-offset-3 col-md-6 col-sm-8 col-sm-offset-2' id='search-bar-container'>
					<%= text_field_tag :something, nil, 
						class: 'form-control search-bar', 
						placeholder: "Search for ingredient" %>
			</div>
			
			<div class='col-md-offset-3 col-md-6 col-sm-8 col-sm-offset-2' id='search-results'>
			</div>
			
			<div class='col-md-offset-3 col-md-6 col-sm-8 col-sm-offset-2' id='ingredient'>
				<%= render partial: "ingredient", 
					locals: {ingredient: @featured_ingredient}%>
			</div>
			
		</div>
	</div>
</div>


<script type='text/javascript'>
	$(document).ready(function(){
		sizeIngredientBar();
		$(window).resize(function(){sizeIngredientBar()});
		
		bindListIngredients();
		
		$(".search-bar").on('input', function(){
			var name = $(this).val()
			if(name.length > 0) {
				toggleIngredient(false);
				searchResults(name);
			} else {
				clearResults();				
				if(name.length == 0) {
					toggleIngredient(true);
				}
			}
		});
	});
	
	function searchResults(name) {
		if(name.length >= 2) {
			$.ajax({
				url: "/ingredients/search",
				data: {
					name: name
				},
				success: function(data){				
					$("#search-results").html(data);
					bindSearchResults();
				}			
			});
		} else {
			clearResults();
		}
	}
	
	function clearResults() {
		$("#search-results").html("");
	}
	
	function toggleIngredient(visible) {
		if(visible) {
			$("#ingredient").fadeIn();
		} else {
			$("#ingredient").hide();
		}
	}
	
	function bindSearchResults(){
		$(".search-result").click(function(){
			var id = $(this).attr('data-id');
			loadIngredient(id);
		});
	}
	
	function loadIngredient(id) {
		clearResults();
		
		$.ajax({
			url: "/ingredients/" + id,
			success: function(data){				
				$("#ingredient").html(data);
				toggleIngredient(true);
			}			
		});
	}
	
	function sizeIngredientBar() {
		var windowHeight = $(window).height();
		$("#ingredient-list").css('height', windowHeight);
	}
	
	function bindListIngredients() {
		$(".list-ingredient").click(function(){
			var id = $(this).attr('data-id');
			loadIngredient(id);
		});
	}
	
</script>